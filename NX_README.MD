perfect â€” chalo Nx pipelines ko abhi init karke build graph + caching + orchestration chalu karte hain (package-based monorepo mode). Steps super-short rakhe hain:

1) Install & Init
# repo root
npm i -D nx @nx/js
npx nx init


Ye aapke repo me nx.json add karega (package-based mode). Nx ab package.json scripts ko targets maan kar graph + cache handle karega.

2) Nx config (cacheable targets)

nx.json ko is minimal config se update/replace kar do:

{
  "nxCloudAccessToken": "",
  "targetDefaults": {
    "build": { "cache": true },
    "test":  { "cache": true },
    "lint":  { "cache": true }
  },
  "tasksRunnerOptions": {
    "default": {
      "runner": "nx/tasks-runners/default",
      "options": { "cacheableOperations": ["build", "test", "lint"] }
    }
  },
  "useInferencePlugins": true
}


dev / start / prisma:* cacheable nahin honge (side-effects). build/test/lint cacheable hain.

3) Per-app outputs (correct cache invalidation)
apps/api/package.json me nx field add karo:
{
  "name": "api",
  // ...
  "nx": {
    "targets": {
      "build": {
        "outputs": ["{workspaceRoot}/dist/apps/api"]
      }
    }
  }
}

apps/web/package.json me:
{
  "name": "web",
  // ...
  "nx": {
    "targets": {
      "build": {
        "outputs": ["{projectRoot}/.next"]
      }
    }
  }
}


Isse Nx ko pata rahega kaunsi folders build output hai (API: dist/apps/api, Web: .next).

4) Root scripts (quality-of-life)

package.json (root) me ye scripts add/update karo:

{
  "scripts": {
    "nx": "nx",
    "build:all": "nx run-many -t build --all --parallel",
    "test:all": "nx run-many -t test --all --parallel",
    "lint:all": "nx run-many -t lint --all --parallel"
  }
}

5) Run & verify
# dependency graph (browser UI khulta hai)
npx nx graph

# build sab projects (cache warm)
npm run build:all

# repeat same command -> near-instant (cache hit)
npm run build:all

# single project:
npx nx build api
npx nx build web


Nx change graph ke basis par sirf affected projects run karta hai:

# e.g. PR me sirf badle hue projects build
npx nx affected -t build

6) (Optional) Nx Cloud = Remote cache in CI
npx nx connect-to-nx-cloud


Free tier enough hota hai. CI ke runs local dev ke cache ko reuse kar paayenge (aur vice-versa).

7) CI tweak (GitHub Actions)

Apne existing workflow me docker build se pehle ek verify step add kar do:

- name: Install deps
  run: npm ci

- name: Prisma generate
  run: npm run prisma:gen

- name: Verify builds via Nx (parallel + cached)
  run: npx nx run-many -t build --all --parallel


Chaaho to tests/lint bhi add kar sakte ho:

- run: npx nx run-many -t test --all --parallel --skip-nx-cache=false
- run: npx nx run-many -t lint --all --parallel

8) Daily usage cheat-sheet

Graph: npx nx graph

All builds: npm run build:all

Only changed: npx nx affected -t build

Parallelism: add --parallel=4 etc.

Skip cache (debug): add --skip-nx-cache